{% extends "main/base.html" %}

{% block title %}
   {{ assignment.name }} - Code
{% endblock %}

{% load staticfiles %}
{% block styles %}
    {{ block.super }}
    <link href="{% static "css/codemirror.css" %}" rel="stylesheet">
    <link href="{% static "css/eclipse.css" %}" rel="stylesheet">
{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script type="text/javascript" src="{% static "js/codemirror.js"%} "></script>
    <script type="text/javascript" src="{% static "js/active-line.js"%} "></script>
    <script type="text/javascript" src="{% static "js/clike.js"%} "></script>
    <script type="text/javascript" src="{% static "js/python.js"%} "></script>
{% endblock %}

{% block content %}
    <div class="container margin-top-30">
        <div class="row">
            <div class="col-md-9 col-sm-8">
                <section id="components">
                    <article class="component-element" id="navs">
                        <h2 class="underline-title no-margin-top">{{ assignment.name }}</h2>
                        <div class="content">{% autoescape off %}{{ assignment.description }}{% endautoescape %}</div>
                        <div class="panel panel-primary">
                            <div class="panel-heading">
                                Please put your code here
                                <span class="badge language pull-right">{{ assignment.language }}</span>
                            </div>
                            <form id="solution" action="{% url "add_solution" course_id assignment.id %}" name="solution"
                                  method="post">
                                {% csrf_token %}
                                <div class="panel-body">
                                    <textarea id="code" name="code">{{ assignment.templateCode }}</textarea>
                                </div>
                                <button type="submit" class="btn btn-success btn-alone pull-right" value="Submit" name="Submit">Submit solution</button>
                            </form>
                        </div>
                    </article>
                </section>
            </div>
            <div class="col-md-3">
                <section>
                    <div class="panel panel-primary">
                        <div class="panel-heading"><i class="fa fa-list-ul"></i>Additional Information</div>
                        <div class="panel-body support-panel">
                            <div class="tab-content">
                                <div class="tab-pane active">
                                    <ul class="nav nav-tabs">
                                        <li class="active">
                                            <a href="#assignments" data-toggle="tab">Assignments</a>
                                        </li>
                                        <li>
                                            <a href="#solutions" data-toggle="tab">Solutions</a>
                                        </li>
                                    </ul>
                                    <div class="tab-content small-panel">
                                        {% if assignments %}
                                            <div class="tab-pane active" id="assignments">
                                                <div class="list-group">
                                                    {% for item in assignments %}
                                                        <a href="{% url "assignment_page" course_id item.id %}" class="list-group-item animated fadeInDown animation-delay-{{ forloop.counter }} {% if assignment.id == item.id %}active{% endif %}">
                                                            <h4 class="list-group-item-heading"><i class="fa fa-caret-right"></i>{{ item.name }}</h4>
                                                        </a>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        {% else %}
                                            <div class="tab-pane padding-15 active" id="assignments">
                                                <h4>No assignments were added yet.</h4>
                                            </div>
                                        {% endif %}
                                        {% if solutions %}
                                            <div class="tab-pane" id="solutions">
                                                <div class="list-group">
                                                    {% for solution in solutions %}
                                                        <a href="{% url "solution_page" course_id assignment.id solution.id %}" class="list-group-item animated fadeInDown animation-delay-{{ forloop.counter }}">
                                                            <span
                                                                    class="badge pull-right">{{ solution.solutionState }}</span>
                                                            <h4 class="list-group-item-heading"><i class="fa fa-caret-right"></i>Solution {{ forloop.counter }}</h4>
                                                        </a>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        {% else %}
                                            <div class="tab-pane padding-15" id="solutions">
                                                <h4>No solutions were added yet.</h4>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts_bottom %}
<script>
(function ($) {

    var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
        {% if assignment.language == 'java' %}
            mode: "text/x-java",
        {% elif assignment.language == 'python' %}
            mode: "python",
        {% endif %}
        styleActiveLine: true,
        lineNumbers: true,
        lineWrapping: true,
        theme: 'eclipse'
    });

{#    $("#solution").ajaxSubmit({#}
{#        url: '{% url "add_solution" course_id assignment.id %}',#}
{#        type: 'post'#}
{#    });#}
    $("#solution").submit(function(e)
    {
        var postData = $(this).serializeArray();
        var formURL = $(this).attr("action");
        $.ajax(
        {
            url : formURL,
            type: "POST",
            data : postData,
            success:function(data)
            {
                alert('success');
                //data: return data from server
            },
            error: function(jqXHR, textStatus, errorThrown)
            {
                alert('fail')
                //if fails
            }
        });
        e.preventDefault();
    });
}(jQuery));
</script>
{% endblock %}